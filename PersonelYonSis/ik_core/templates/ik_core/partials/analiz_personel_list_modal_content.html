<div class="px-3 py-2 border-bottom d-flex justify-content-between align-items-center bg-light">
    <div>
        <span class="fw-bold text-primary">{{ total_count }}</span> Personel Listeleniyor
    </div>
</div>

<div class="table-responsive">
    <table class="table table-striped table-hover mb-0" style="font-size: 0.9rem;">
        <thead class="table-light sticky-top" style="top: 0; z-index: 10;">
            <tr>
                <th>Ad Soyad</th>
                {% comment %} Birim column hidden because it is grouped {% endcomment %}
                <th>Yaş</th>
                <th>Ünvan / Branş</th>
                <th>Kadro Durumu</th>
                <th>Özel Durumlar</th>
                <th>Durum</th>
                <th>İşlemler</th>
            </tr>
        </thead>
        <tbody>
            {% for birim_ad, p_list in grouped_personnel.items %}
                <!-- Group Header Row -->
                <tr class="table-secondary">
                        <i class="bi bi-building"></i> {{ birim_ad }} 
                        <span class="badge bg-secondary ms-2 rounded-pill">{{ p_list|length }}</span>
                    </td>
                </tr>

                <!-- Personnel Rows -->
                {% for p in p_list %}
                <tr>
                    <td class="ps-4">
                        <div class="fw-bold">{{ p.ad_soyad }}</div>
                    </td>
                    {% comment %} 
                    No Birim column here
                    <td>{{ p.son_birim_kaydi|default:"-" }}</td> 
                    {% endcomment %}
                    <td>{{ p.yas|default:"-" }}</td>
                    <td>
                        {{ p.unvan.ad|default:"-" }} / {{ p.brans.ad|default:"" }}
                    </td>
                    <td>
                        {% if p.kadrolu_personel %}
                        <span class="badge bg-success bg-opacity-10 text-success border border-success">Kadrolu</span>
                        {% else %}
                        <span class="badge bg-warning bg-opacity-10 text-warning border border-warning">Geçici Gelen</span>
                        {% endif %}
                    </td>
                    <td>
                        {% for oz in p.ozel_durumu.all %}
                            <span class="badge bg-info text-dark mb-1">{{ oz.ad }}</span>
                        {% empty %}
                            <span class="text-muted small">-</span>
                        {% endfor %}
                    </td>
                    <td>
                        <span class="badge bg-secondary">{{ p.durum }}</span>
                    </td>
                    <td class="text-end">
                        <button type="button" class="btn btn-sm btn-outline-primary set-yeni-birim-btn" data-personel-id="{{ p.id }}">Birim Değiştir</button>
                    </td>
                </tr>
                {% endfor %}
            {% empty %}
            <tr>
                <td colspan="9" class="text-center py-4 text-muted">Personel bulunamadı.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
