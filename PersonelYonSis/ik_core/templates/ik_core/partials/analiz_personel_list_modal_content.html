<div class="px-3 py-2 border-bottom d-flex justify-content-between align-items-center bg-light">
    <div>
        <span class="fw-bold text-primary">{{ total_count }}</span> Personel Listeleniyor
    </div>
</div>

<div class="table-responsive">
    <table class="table table-sm table-striped table-hover mb-0" style="font-size: 0.85rem;">
        <thead class="table-light sticky-top" style="top: 0; z-index: 10;">
            <tr>
                <th class="p-1">Ad Soyad</th>
                <th class="p-1">Yaş</th>
                <th class="p-1">Kısa Unvan</th>
                <th class="p-1">Açıklama</th>
                <th class="p-1">Kadro Durumu</th>
                <th class="p-1">Özel Durumlar</th>
                <th class="p-1">Durum</th>
                <th class="p-1">İşlemler</th>
            </tr>
        </thead>
        <tbody>
            {% for birim_ad, p_list in grouped_personnel.items %}
                <!-- Group Header Row -->
                <tr class="table-secondary">
                    <td colspan="8" class="fw-bold text-dark ps-2 py-1">
                        <i class="bi bi-building"></i> {{ birim_ad }} 
                        <span class="badge bg-secondary ms-2 rounded-pill">{{ p_list|length }}</span>
                    </td>
                </tr>

                <!-- Personnel Rows -->
                {% for p in p_list %}
                <tr>
                    <td class="p-1 ps-2">
                        <div class="fw-bold">{{ p.ad_soyad }}</div>
                    </td>
                    <td class="p-1">{{ p.yas|default:"-" }}</td>
                    <td class="p-1">
                        {{ p.kisa_unvan_ad|default:"-" }}
                    </td>
                    <td class="p-1">
                        <div class="editable-note" 
                             contenteditable="true" 
                             data-personel-birim-id="{{ p._last_pb_id|default:'' }}"
                             style="min-height: 20px; border-bottom: 1px dashed #ccc; cursor: text;">
                            {{ p.aciklama|default:"" }}
                        </div>
                    </td>
                    <td class="p-1">
                        {% if p.kadrolu_personel %}
                        <span class="badge bg-success bg-opacity-10 text-success border border-success">Kadrolu</span>
                        {% else %}
                        <span class="badge bg-warning bg-opacity-10 text-warning border border-warning">Geçici</span>
                        {% endif %}
                    </td>
                    <td class="p-1">
                        {% for oz in p.ozel_durumu.all %}
                            <span class="badge bg-info text-dark mb-1 me-1">{{ oz.ad }}</span>
                        {% empty %}
                            <span class="text-muted small">-</span>
                        {% endfor %}
                    </td>
                    <td class="p-1">
                        <span class="badge bg-secondary">{{ p.durum }}</span>
                    </td>
                    <td class="text-end p-1">
                        <button type="button" class="btn btn-sm btn-outline-primary set-yeni-birim-btn py-0 px-2" style="font-size: 0.8rem;" data-personel-id="{{ p.id }}">Birim Değiştir</button>
                    </td>
                </tr>
                {% endfor %}
            {% empty %}
            <tr>
                <td colspan="9" class="text-center py-4 text-muted">Personel bulunamadı.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
