<div class="modal-header">
    <h5 class="modal-title">İcra Hareketleri - {{ icra.personel.ad }} {{ icra.personel.soyad }} ({{ icra.icra_dairesi }})</h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<div class="modal-body">
    <div class="row">
        <div class="col-md-7">
            <h6>Hareket Listesi</h6>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Kesilen Tutar</th>
                        <th>Kesildiği Dönem</th>
                        <th>Ödeme Türü</th>
                    </tr>
                </thead>
                <tbody>
                    {% for hareket in hareketler %}
                    <tr>
                        <td>{{ hareket.kesilen_tutar }}</td>
                        <td>
                            {% with y=hareket.kesildigi_donem|date:"Y" m=hareket.kesildigi_donem|date:"m" %}
                                {{ y }}/{{ m }}
                            {% endwith %}
                        </td>
                        <td>{{ hareket.get_odeme_turu_display }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3" class="text-center">Kayıt bulunamadı.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <p><strong>Toplam Kesinti:</strong> {{ toplam_kesinti }} | <strong>Kalan Borç:</strong> {{ kalan_borc }}</p>
        </div>
        <div class="col-md-5">
            <h6>Yeni Hareket Ekle</h6>
            <form id="icraHareketForm" action="{% url 'mutemet_app:icra_hareket_ekle' icra.icra_id %}" method="post" {% if kalan_borc == 0 %}class="readonly-form"{% endif %}>
                {% csrf_token %}
                <input type="hidden" name="icra_id" value="{{ icra.icra_id }}">
                <input type="hidden" name="kalan_borc" value="{{ kalan_borc }}">
                <div class="mb-3">
                    <label for="kesilen_tutar" class="form-label">Kesilen Tutar</label>
                    <input type="number" step="0.01" class="form-control" name="kesilen_tutar" required {% if kalan_borc == 0 %}readonly{% endif %}>
                </div>
                <div class="mb-3">
                    <label for="kesildigi_donem" class="form-label">Kesildiği Dönem</label>
                    <select class="form-select" name="kesildigi_donem" required {% if kalan_borc == 0 %}disabled{% endif %}>
                        <option value="" selected disabled>Seçiniz...</option>
                        {% for d in donem_secenekleri %}
                            <option value="{{ d|date:'Y-m-01' }}">
                                {{ d|date:'Y' }}/{{ d|date:'m' }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="mb-3">
                    <label for="odeme_turu" class="form-label">Ödeme Türü</label>
                    <select class="form-select" name="odeme_turu" required {% if kalan_borc == 0 %}disabled{% endif %}>
                        <option value="" selected disabled>Seçiniz...</option>
                        <option value="DENGE">Denge</option>
                        <option value="DENGE FARK">Denge Fark</option>
                        <option value="EK ÖDEME">Ek Ödeme</option>
                        <option value="ELDEN">Elden</option>
                        <option value="İKRAMİYE">İkramiye</option>
                        <option value="MAAŞ">Maaş</option>
                        <option value="NAFAKA">Nafaka</option>
                        <option value="SABİT">Sabit</option>
                        <option value="SABİT FARK">Sabit Fark</option>
                        <option value="TEMEL">Temel</option>
                        <option value="TEŞVİK">Teşvik</option>
                        <option value="TOPLU GİRİŞ">Toplu Giriş</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" {% if kalan_borc == 0 %}disabled{% endif %}>Kaydet</button>
            </form>
        </div>
    </div>
</div>
